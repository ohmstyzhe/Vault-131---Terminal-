/* =========================================================
   VAULT 131 — HEAVY CRT STYLES (PIXEL / MASK HEAVY)
   Works with your existing markup:
   .crt, .terminal, .screen, .topbar, .statusbar
   Optional overlay divs:
   .crt__outer .crt__vignette .crt__scanlines .crt__noise
   ========================================================= */

/* ===== GLOBAL / THEME ===== */
:root{
  --bg: #000;

  --phosphor: #7CFF63;
  --phosphor-dim: rgba(124,255,99,.65);
  --phosphor-faint: rgba(124,255,99,.25);

  /* CRT tuning */
  --crt-curvature: 22px;         /* screen rounding */
  --crt-glow: 0.55;              /* bloom strength */
  --crt-ghost: 0.14;             /* phosphor persistence */
  --crt-flicker: 0.09;           /* flicker amount */

  --scanline-opacity: 0.42;      /* horizontal scanlines */
  --scanline-gap: 3px;           /* spacing */
  --scanline-thickness: 1px;     /* line thickness */

  --mask-opacity: 0.28;          /* RGB “pixel” mask strength */
  --mask-size: 3px;              /* RGB triad width (try 2px or 4px) */

  --noise-opacity: 0.16;         /* grit */
  --vignette-opacity: 0.85;      /* edge darkening */
}

/* ===== RESET ===== */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  background: var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  overflow:hidden;
  -webkit-font-smoothing: none;     /* helps it feel less “retina-clean” */
  text-rendering: geometricPrecision;
}

/* ===== OUTER CRT SHELL ===== */
.crt{
  position:relative;
  width:min(980px, 94vw);
  height:min(680px, 90vh);
  padding:22px;
  border-radius:28px;

  background:
    radial-gradient(120% 120% at 50% 10%, rgba(255,255,255,.06), rgba(255,255,255,0) 55%),
    linear-gradient(#0a0b0a, #000);

  box-shadow:
    0 40px 140px rgba(0,0,0,.90),
    inset 0 0 0 2px rgba(255,255,255,.05),
    inset 0 0 40px rgba(0,0,0,.75);
}

/* iPad safe area */
@supports (padding: env(safe-area-inset-top)) {
  .crt { padding-top: calc(22px + env(safe-area-inset-top)); }
}

/* ===== SCREEN (GLASS) ===== */
.terminal{
  position:relative;
  width:100%;
  height:100%;
  border-radius: var(--crt-curvature);
  overflow:hidden;

  background:
    radial-gradient(140% 120% at 50% 35%, rgba(124,255,99,.16) 0%, rgba(0,0,0,0) 60%),
    linear-gradient(#020402, #000);

  box-shadow:
    inset 0 0 75px rgba(0,0,0,.90),
    inset 0 0 0 1px rgba(124,255,99,.06);
}

/* curvature + glass sheen */
.terminal::before{
  content:"";
  position:absolute; inset:0;
  pointer-events:none;
  border-radius: var(--crt-curvature);
  background:
    radial-gradient(140% 120% at 50% 40%, rgba(255,255,255,.08), rgba(255,255,255,0) 55%),
    radial-gradient(120% 90% at 50% 120%, rgba(0,0,0,.65), rgba(0,0,0,0) 55%);
  opacity:.55;
  mix-blend-mode: screen;
}

/* subtle barrel distortion illusion */
.terminal{
  transform: perspective(900px) translateZ(0);
}
.terminal > *{
  transform: translateZ(0);
}

/* ===== TOP / STATUS BARS ===== */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px 10px 16px;
  color: var(--phosphor);
  letter-spacing:.10em;
  user-select:none;

  /* CRT glow */
  text-shadow:
    0 0 22px rgba(124,255,99,var(--crt-glow)),
    0 0 4px rgba(124,255,99,.45);
  opacity:.92;
}
.topbar__center{ opacity:.85; }

.statusbar{
  position:absolute;
  left:0; right:0; bottom:0;
  padding: 10px 14px;
  background: rgba(124,255,99,.10);
  border-top: 1px solid rgba(124,255,99,.18);
  color: rgba(124,255,99,.96);
  text-shadow:
    0 0 18px rgba(124,255,99,.35),
    0 0 3px rgba(124,255,99,.35);
  font-size: 15px;
  user-select:none;
}

/* ===== MAIN TEXT AREA ===== */
.screen{
  position:relative;
  height: calc(100% - 108px);
  padding: 10px 18px 16px 18px;
  color: var(--phosphor);
  font-size: 18px;
  line-height: 1.35;

  /* heavy glow + slight chroma split */
  text-shadow:
    0 0 26px rgba(124,255,99,var(--crt-glow)),
    0 0 4px rgba(124,255,99,.55),
    -0.9px 0 rgba(0,255,160,.22),
     0.9px 0 rgba(120,120,255,.14);

  filter: saturate(1.15) contrast(1.05);
}

/* Phosphor persistence “ghost” */
.screen::after{
  content:"";
  position:absolute; inset:0;
  pointer-events:none;
  background: rgba(124,255,99,.10);
  opacity: var(--crt-ghost);
  mix-blend-mode: screen;
  filter: blur(0.8px);
}

/* ===== UI ELEMENTS ===== */
h1,h2{ margin:0 0 10px 0; font-size: 22px; letter-spacing:.10em; }
.dim{ color: var(--phosphor-dim); }
.faint{ color: var(--phosphor-faint); }
hr{
  border:none;
  border-top:1px solid rgba(124,255,99,.22);
  margin:14px 0;
}

.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}

label{
  display:block;
  margin: 10px 0 6px 0;
  color: var(--phosphor-dim);
}

input{
  width: min(520px, 100%);
  padding: 12px 12px;
  border-radius: 8px;
  border: 1px solid rgba(124,255,99,.22);
  background: rgba(0,0,0,.55);
  color: var(--phosphor);
  font: inherit;
  outline:none;
  box-shadow: inset 0 0 18px rgba(0,0,0,.78);
}
input:focus{
  border-color: rgba(124,255,99,.55);
  box-shadow:
    0 0 0 3px rgba(124,255,99,.10),
    inset 0 0 18px rgba(0,0,0,.78);
}

button{
  font: inherit;
  color: var(--phosphor);
  background: rgba(0,0,0,.34);
  border: 1px solid rgba(124,255,99,.32);
  padding: 10px 14px;
  border-radius: 10px;
  cursor:pointer;
  user-select:none;
  transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease;
}
button:active{ transform: translateY(1px); }
button.glow,
button:hover{
  border-color: rgba(124,255,99,.75);
  box-shadow:
    0 0 18px rgba(124,255,99,.20),
    0 0 44px rgba(124,255,99,.10);
}

.small{ font-size: 14px; }

.codebox{
  display:inline-block;
  padding: 10px 12px;
  border: 1px dashed rgba(124,255,99,.35);
  border-radius: 10px;
  background: rgba(0,0,0,.45);
  letter-spacing:.22em;
  font-size: 22px;
}

/* =========================================================
   HEAVY CRT OVERLAYS (THE IMPORTANT PART)
   Uses BOTH your overlay DIVs (if present) and pseudo layers.
   ========================================================= */

/* If you have <div class="crt__outer"></div> */
.crt__outer{
  position:absolute; inset:22px;
  border-radius: var(--crt-curvature);
  pointer-events:none;
  background:
    radial-gradient(110% 95% at 50% 20%, rgba(255,255,255,.06), rgba(255,255,255,0) 55%),
    radial-gradient(120% 120% at 50% 50%, rgba(0,0,0,.0) 45%, rgba(0,0,0,.35) 100%);
  mix-blend-mode: screen;
  opacity:.55;
}

/* Your overlay divs */
.crt__vignette,
.crt__scanlines,
.crt__noise{
  position:absolute; inset:22px;
  border-radius: var(--crt-curvature);
  pointer-events:none;
}

/* Vignette */
.crt__vignette{
  background:
    radial-gradient(120% 100% at 50% 50%,
      rgba(0,0,0,0) 38%,
      rgba(0,0,0,var(--vignette-opacity)) 100%);
  mix-blend-mode:multiply;
  opacity: .95;
}

/* Scanlines (crisper + denser) */
.crt__scanlines{
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(0,0,0,0) 0px,
      rgba(0,0,0,0) calc(var(--scanline-gap) - var(--scanline-thickness)),
      rgba(0,0,0,var(--scanline-opacity)) var(--scanline-gap)
    );
  opacity: .78;
  mix-blend-mode: multiply;
}

/* Noise texture (uses your assets/noise.png) */
.crt__noise{
  background-image: url("assets/noise.png");
  background-size: 220px 220px;
  opacity: var(--noise-opacity);
  mix-blend-mode: overlay;
  animation: noiseShift .55s steps(2,end) infinite;
}

/* RGB “pixel” mask layer (THIS is the “I can see pixels” look)
   We add it as a pseudo layer so it works even if your HTML changes. */
.terminal::after{
  content:"";
  position:absolute; inset:0;
  pointer-events:none;
  border-radius: var(--crt-curvature);

  /* Two layers:
     1) RGB triads across X
     2) faint vertical grille to break “perfect” look */
  background:
    repeating-linear-gradient(
      90deg,
      rgba(255,0,0,var(--mask-opacity)) 0px,
      rgba(255,0,0,var(--mask-opacity)) 1px,
      rgba(0,255,0,var(--mask-opacity)) 1px,
      rgba(0,255,0,var(--mask-opacity)) 2px,
      rgba(0,140,255,var(--mask-opacity)) 2px,
      rgba(0,140,255,var(--mask-opacity)) var(--mask-size)
    ),
    repeating-linear-gradient(
      90deg,
      rgba(0,0,0,.10) 0px,
      rgba(0,0,0,.10) 1px,
      rgba(0,0,0,0) 3px,
      rgba(0,0,0,0) 6px
    );

  opacity: .85;
  mix-blend-mode: multiply;
  transform: translateZ(0);
}

/* Rolling scan band (the moving bright-ish bar you see on CRT footage) */
.screen::before{
  content:"";
  position:absolute; inset:-20%;
  pointer-events:none;

  background:
    linear-gradient(
      to bottom,
      rgba(255,255,255,0) 0%,
      rgba(255,255,255,.06) 45%,
      rgba(255,255,255,.12) 50%,
      rgba(255,255,255,.06) 55%,
      rgba(255,255,255,0) 100%
    );

  mix-blend-mode: screen;
  opacity: .18;
  animation: roll 6.5s linear infinite;
}

/* Flicker + tiny jitter on the whole CRT wrapper */
.crt{
  animation: flicker 5.1s infinite;
}

@keyframes flicker{
  0%, 100% { filter: brightness(1) contrast(1.06); transform: translateY(0); }
  49%      { filter: brightness(1.03) contrast(1.08); }
  50%      { filter: brightness(calc(1 - var(--crt-flicker))) contrast(1.14); transform: translateY(.6px); }
  52%      { filter: brightness(1.02) contrast(1.10); transform: translateY(-.4px); }
  70%      { filter: brightness(1.01) contrast(1.10); }
}

@keyframes noiseShift{
  0%{ transform: translate(0,0); }
  25%{ transform: translate(-3px,2px); }
  50%{ transform: translate(2px,-2px); }
  75%{ transform: translate(3px,1px); }
  100%{ transform: translate(0,0); }
}

@keyframes roll{
  0%   { transform: translateY(-35%); }
  100% { transform: translateY(35%); }
}

/* Slightly “roughen” edges like a tube */
.terminal{
  outline: 1px solid rgba(124,255,99,.08);
  outline-offset: -1px;
}

/* Accessibility */
@media (prefers-reduced-motion: reduce){
  .crt, .crt__noise, .screen::before{ animation:none !important; }
}