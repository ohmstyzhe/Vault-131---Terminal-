:root{
  --crt-bg:#020302;
  --p:#7CFF7A;

  /* HARD knobs */
  --noise-opacity:.34;   /* heavy grain */
  --mask-opacity:.36;    /* aggressive RGB grille */
  --scan-opacity:.54;    /* strong scanlines */
  --vignette-strength:.92;

  /* glow */
  --txt-glow-1: rgba(124,255,122,.85);
  --txt-glow-2: rgba(124,255,122,.48);
  --txt-glow-3: rgba(124,255,122,.26);
  --txt-glow-4: rgba(124,255,122,.14);

  --wobble:.55px;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }

body{
  margin:0;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  -webkit-font-smoothing: antialiased;
}

/* Outer shell */
.crt{
  position:relative;
  width:min(980px, 94vw);
  height:min(680px, 90vh);
  padding:22px;
  border-radius:28px;
  background:
    radial-gradient(120% 120% at 50% 40%, rgba(124,255,122,.06), rgba(0,0,0,.92) 60%, #000 100%);
  box-shadow:
    0 40px 120px rgba(0,0,0,.90),
    inset 0 0 0 2px rgba(255,255,255,.04);
}

/* iPad safe area */
@supports (padding: env(safe-area-inset-top)) {
  .crt { padding-top: calc(22px + env(safe-area-inset-top)); }
}

/* Screen container */
.terminal{
  position:relative;
  width:100%;
  height:100%;
  border-radius:18px;
  overflow:hidden;
  isolation:isolate; /* keeps blend modes sane */

  /* DARK tube */
  background:
    radial-gradient(120% 95% at 50% 40%, rgba(124,255,122,.12) 0%, rgba(0,0,0,0) 56%),
    radial-gradient(160% 120% at 50% 55%, rgba(0,0,0,0) 0%, rgba(0,0,0,.76) 60%, rgba(0,0,0,.97) 100%),
    linear-gradient(#020302, #000);
  box-shadow: inset 0 0 100px rgba(0,0,0,.95);

  animation: crtFlicker 4.6s infinite;
  
  filter: saturate(.88) brightness(.96);
}

/* Glass sheen */
.terminal::before{
  content:"";
  position:absolute; inset:-2%;
  background:
    radial-gradient(140% 120% at 50% 45%, rgba(255,255,255,.08) 0%, rgba(255,255,255,0) 52%),
    radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.05) 0%, rgba(255,255,255,0) 40%);
  pointer-events:none;
  mix-blend-mode: screen;
  opacity:.40;
  transform: scale(1.02);
  z-index: 2;
}

/* CONTENT LAYER (below overlays) */
.terminal__content{
  position:relative;
  z-index: 3;

  height:100%;
  display:flex;
  flex-direction:column;

  /* IMPORTANT: no global bloom here (prevents weird iOS layout/bleed) */
  filter:none !important;
  transform: translateZ(0);
}

/* Top bar */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px 10px 16px;
  letter-spacing:.10em;
  user-select:none;
  color: var(--p);
  opacity:.94;

  text-shadow:
    0 0 4px var(--txt-glow-1),
    0 0 12px var(--txt-glow-2),
    0 0 26px var(--txt-glow-3);
}
.topbar__center{ opacity:.86; }

/* Main area now flexes correctly (no overlap with footer) */
.screen{
  flex: 1;
  min-height: 0;            /* critical for iOS flex scroll sizing */
  overflow:auto;            /* if content grows, it scrolls */
  padding: 10px 18px 16px 18px;

  color: var(--p);
  font-size: 18px;
  line-height: 1.35;

  /* glow + phosphor sparkle */
  text-shadow:
    0 0 1px rgba(255,255,255,.22),
    0 0 3px var(--txt-glow-1),
    0 0 12px var(--txt-glow-2),
    0 0 26px var(--txt-glow-3),
    0 0 44px var(--txt-glow-4);

  /* tiny tube softness (not full blur) */
  filter:
  blur(.28px)
  contrast(1.12)
  saturate(1.12)
  drop-shadow(0 0 6px rgba(124,255,122,.18));
  drop-shadow(0 0 26px rgba(124,255,122,.14));
}

/* Headings / strong “burn” */
.screen h1, .screen h2, .screen strong{
  color: var(--p);
  text-shadow:
    0 0 2px rgba(255,255,255,.24),
    0 0 8px rgba(124,255,122,.85),
    0 0 14px rgba(124,255,122,.35),
    0 0 34px rgba(124,255,122,.14);
}

/* Status bar is NOT absolute anymore */
.statusbar{
  flex: 0 0 auto;
  padding: 10px 14px;
  background: rgba(124,255,122,.07);
  border-top: 1px solid rgba(124,255,122,.18);

  color: rgba(124,255,122,.95);
  font-size: 15px;
  user-select:none;

  text-shadow:
    0 0 2px rgba(255,255,255,.18),
    0 0 12px rgba(124,255,122,.34);
}

/* Inputs/buttons */
label{
  display:block;
  margin: 10px 0 6px 0;
  color: rgba(124,255,122,.65);
}
input{
  width:min(520px,100%);
  padding:12px 12px;
  border-radius:8px;
  border:1px solid rgba(124,255,122,.22);
  background: rgba(0,0,0,.56);
  color: var(--p);
  font: inherit;
  outline:none;
  box-shadow: inset 0 0 18px rgba(0,0,0,.82);
  text-shadow: 0 0 10px rgba(124,255,122,.18);
}
input:focus{
  border-color: rgba(124,255,122,.60);
  box-shadow: 0 0 0 3px rgba(124,255,122,.10), inset 0 0 18px rgba(0,0,0,.82);
}
button{
  font: inherit;
  color: var(--p);
  background: rgba(0,0,0,.32);
  border: 1px solid rgba(124,255,122,.32);
  padding: 10px 14px;
  border-radius: 10px;
  cursor:pointer;
  user-select:none;
  transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease;

  text-shadow: 0 0 10px rgba(124,255,122,.20);
}
button:active{ transform: translateY(1px); }
button:hover{
  border-color: rgba(124,255,122,.75);
  box-shadow: 0 0 18px rgba(124,255,122,.18), 0 0 44px rgba(124,255,122,.10);
}

/* ==============================
   OVERLAYS — ABOVE content, crisp
   ============================== */
.crt__vignette,
.crt__scanlines,
.crt__mask,
.crt__noise{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index: 6;
}

/* vignette */
.crt__vignette{
  background:
    radial-gradient(120% 100% at 50% 50%,
      rgba(0,0,0,0) 32%,
      rgba(0,0,0,.72) 78%,
      rgba(0,0,0,1) 100%);
  opacity: var(--vignette-strength);
  mix-blend-mode: multiply;
}

/* scanlines stay crisp (no blur/filter on this layer) */
.crt__scanlines{
  opacity: var(--scan-opacity);
  animation: scanWobble 0.08s steps(2,end) infinite;
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(0,0,0,0) 0px,
      rgba(0,0,0,0) 2px,
      rgba(0,0,0,.32) 3px
    ),
    repeating-linear-gradient(
      to bottom,
      rgba(255,255,255,0) 0px,
      rgba(255,255,255,0) 18px,
      rgba(0,0,0,.12) 19px
    );
  mix-blend-mode: multiply;
}

/* aggressive RGB grille */
.crt__mask{
  opacity: var(--mask-opacity);
  background:
    repeating-linear-gradient(
      to right,
      rgba(255,0,0,.32) 0px,
      rgba(255,0,0,.32) 1px,
      rgba(0,255,0,.26) 1px,
      rgba(0,255,0,.26) 2px,
      rgba(0,140,255,.26) 2px,
      rgba(0,140,255,.26) 3px
    ),
    radial-gradient(circle at 50% 50%, rgba(255,255,255,.12) 0 1px, rgba(255,255,255,0) 2px);
  background-size: 3px 100%, 4px 4px;
  mix-blend-mode: overlay;
  filter: contrast(1.3) saturate(1.25);
}

/* ==============================
   CLEAN BASE GRAIN (mid-layer)
   ============================== */

.crt__noise{
  opacity: .28;                /* base grain, not too hot */
  mix-blend-mode: overlay;
  background-image:
    url("assets/noise.png"),
    repeating-linear-gradient(
      0deg,
      rgba(255,255,255,.02) 0 1px,
      rgba(0,0,0,0) 2px
    );
  background-size:
    240px 240px,
    100% 6px;
  animation: noiseMove .32s steps(2,end) infinite;
}

/* jittery fuzzy movement (very CRT) */
@keyframes fuzzyGrain{
  0%   { background-position: 0 0, 0 0; }
  25%  { background-position: -10px 6px, 0 0; }
  50%  { background-position: 12px -8px, 0 0; }
  75%  { background-position: -6px 4px, 0 0; }
  100% { background-position: 0 0, 0 0; }
}

/* ==============================
   NEW: FUZZY TOP-LAYER GRAIN
   (this is the “fuzzy static”)
   ============================== */

.crt__fuzzy-grain{
  position:absolute;
  inset:0;
  pointer-events:none;
  z-index: 10; /* ABOVE EVERYTHING */

  /* true fuzzy static texture */
  background-image:
    url("assets/noise.png"),
    repeating-linear-gradient(
      to right,
      rgba(255,255,255,.06) 0 1px,
      rgba(0,0,0,.02) 2px
    );

  background-size:
    180px 180px,
    3px 100%;

  opacity: .28;          /* strength of fuzz */
  mix-blend-mode: screen;

  filter:
    contrast(1.25)
    saturate(1.05)
    blur(.60px);         /* this makes it look “fuzzy” instead of digital */

  animation: fuzzyGrain 0.18s steps(2,end) infinite;
}

/* ==============================
   BLOOM TARGETING
   ============================== */

/* Apply bloom only to “hero” elements.
   You already add class="bloom" to topbar labels in index. */
.bloom,
.screen h1,
.screen h2,
button{
  filter: url(#crtBloom);
}

/* Keep body text crisp-ish (glow via text-shadow only) */
.screen,
.statusbar,
label,
input,
#statusText,
.screen p,
.screen small,
.screen .dim,
.screen .faint{
  filter: none !important;
}

/* Flicker / wobble */
@keyframes crtFlicker{
  0%,100% { filter: brightness(1.00) contrast(1.03); transform: translateY(0); }
  48% { filter: brightness(1.03) contrast(1.07); }
  50% { filter: brightness(.94) contrast(1.14); transform: translateY(var(--wobble)); }
  52% { filter: brightness(1.02) contrast(1.08); transform: translateY(calc(var(--wobble) * -0.7)); }
  70% { filter: brightness(1.00) contrast(1.07); }
}

@keyframes noiseMove{
  0%   { background-position: 0 0, 0 0, 0 0; }
  25%  { background-position: -18px 10px, 0 0, 0 0; }
  50%  { background-position: 14px -14px, 0 0, 0 0; }
  75%  { background-position: 22px 8px, 0 0, 0 0; }
  100% { background-position: 0 0, 0 0, 0 0; }
}

@keyframes scanWobble{
  0%   { transform: translateY(0); }
  50%  { transform: translateY(.15px); }
  100% { transform: translateY(0); }
}