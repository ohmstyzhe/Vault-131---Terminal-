/* =========================================================
   VAULT 131 — HEAVY CRT (iPad Safari-friendly)
   Goal: visible RGB triad / pixel mask + scanlines + grain
   Avoid: backdrop-filter + heavy mix-blend-mode (Safari issues)
========================================================= */

:root{
  --bg: #000;
  --phosphor: #7CFF7A;
  --phosphor-dim: rgba(124,255,122,.65);

  /* CRT knobs */
  --crt-contrast: 1.18;
  --crt-bright: 1.05;
  --crt-sat: 1.12;

  --vignette: .70;          /* 0-1 */
  --scan-opacity: .22;      /* scanlines */
  --triad-opacity: .22;     /* RGB mask strength (this is the “pixels”) */
  --noise-opacity: .14;     /* film grain */
  --glow: .55;              /* text glow strength */
}

/* ===== Reset ===== */
*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  background: var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  overflow:hidden;
  color: var(--phosphor);
}

/* ===== Main CRT shell ===== */
.crt{
  position:relative;
  width:min(980px, 94vw);
  height:min(680px, 90vh);
  padding:22px;
  border-radius:28px;
  background:#020402;
  box-shadow:
    0 40px 120px rgba(0,0,0,.85),
    inset 0 0 0 2px rgba(255,255,255,.04);
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* iPad safe-area */
@supports (padding: env(safe-area-inset-top)) {
  .crt { padding-top: calc(22px + env(safe-area-inset-top)); }
}

.terminal{
  position:relative;
  width:100%;
  height:100%;
  border-radius:18px;
  overflow:hidden;
  background: radial-gradient(120% 90% at 50% 35%, rgba(124,255,122,.10) 0%, rgba(0,0,0,0) 62%),
              linear-gradient(#010301, #000);
  box-shadow: inset 0 0 70px rgba(0,0,0,.88);
  filter: saturate(var(--crt-sat)) contrast(var(--crt-contrast)) brightness(var(--crt-bright));
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* ===== Top + content ===== */
.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px 10px 16px;
  letter-spacing:.08em;
  opacity:.92;
  user-select:none;
  text-shadow: 0 0 12px rgba(124,255,122,.35);
}
.topbar__center{ opacity:.85; }

.screen{
  position:relative;
  height: calc(100% - 108px);
  padding: 10px 18px 16px 18px;
  font-size: 18px;
  line-height: 1.35;

  /* CRT glow + slight chroma fringing */
  text-shadow:
    0 0 calc(18px * var(--glow)) rgba(124,255,122,.45),
    0 0 2px rgba(124,255,122,.35),
    -0.7px 0 rgba(0,255,120,.18),
    0.7px 0 rgba(120,120,255,.10);
}

.statusbar{
  position:absolute;
  left:0; right:0; bottom:0;
  padding: 10px 14px;
  background: rgba(124,255,122,.10);
  border-top: 1px solid rgba(124,255,122,.20);
  font-size: 15px;
  user-select:none;
  text-shadow: 0 0 10px rgba(124,255,122,.25);
}

/* ===== Inputs + buttons ===== */
label{
  display:block;
  margin: 10px 0 6px 0;
  color: var(--phosphor-dim);
}
input{
  width: min(520px, 100%);
  padding: 12px 12px;
  border-radius: 8px;
  border: 1px solid rgba(124,255,122,.25);
  background: rgba(0,0,0,.55);
  color: var(--phosphor);
  font: inherit;
  outline:none;
  box-shadow: inset 0 0 18px rgba(0,0,0,.75);
}
input:focus{
  border-color: rgba(124,255,122,.55);
  box-shadow: 0 0 0 3px rgba(124,255,122,.12), inset 0 0 18px rgba(0,0,0,.75);
}
button{
  font: inherit;
  color: var(--phosphor);
  background: rgba(0,0,0,.35);
  border: 1px solid rgba(124,255,122,.35);
  padding: 10px 14px;
  border-radius: 10px;
  cursor:pointer;
  user-select:none;
  transition: transform .08s ease, box-shadow .2s ease, border-color .2s ease;
}
button:active{ transform: translateY(1px); }
button:hover{
  border-color: rgba(124,255,122,.75);
  box-shadow:
    0 0 18px rgba(124,255,122,.22),
    0 0 40px rgba(124,255,122,.12);
}

/* =========================================================
   CRT OVERLAYS (Safari-friendly)
   Use plain layered backgrounds (no backdrop-filter).
========================================================= */

/* Put these as siblings above .terminal in your HTML */
.crt__vignette,
.crt__scanlines,
.crt__noise,
.crt__mask,
.crt__sheen{
  position:absolute;
  inset:22px;
  border-radius:18px;
  pointer-events:none;
  z-index: 20;
}

/* Curved glass + edge darkening */
.crt__vignette{
  opacity: var(--vignette);
  background:
    radial-gradient(120% 100% at 50% 50%,
      rgba(0,0,0,0) 35%,
      rgba(0,0,0,.80) 100%),
    radial-gradient(140% 120% at 50% 50%,
      rgba(255,255,255,.05) 0%,
      rgba(255,255,255,0) 55%);
}

/* Scanlines (tighter = more “CRT”) */
.crt__scanlines{
  opacity: var(--scan-opacity);
  background:
    repeating-linear-gradient(
      to bottom,
      rgba(0,0,0,0) 0px,
      rgba(0,0,0,0) 2px,
      rgba(0,0,0,.65) 3px
    );
}

/* RGB triad / pixel mask */
.crt__mask{
  opacity: var(--triad-opacity);
  background:
    /* vertical grille */
    repeating-linear-gradient(
      to right,
      rgba(255,0,0,.38) 0px,
      rgba(255,0,0,.38) 1px,
      rgba(0,255,0,.34) 1px,
      rgba(0,255,0,.34) 2px,
      rgba(0,140,255,.30) 2px,
      rgba(0,140,255,.30) 3px
    );
  /* “pixel-ish” look: keep it crisp */
  image-rendering: pixelated;
  -webkit-image-rendering: pixelated;
}

/* Grain/noise from your assets/noise.png */
.crt__noise{
  opacity: var(--noise-opacity);
  background-image: url("assets/noise.png");
  background-size: 140px 140px;
  animation: noiseShift .45s steps(2,end) infinite;
}

/* light screen sheen */
.crt__sheen{
  opacity:.22;
  background:
    radial-gradient(120% 70% at 20% 0%,
      rgba(255,255,255,.10) 0%,
      rgba(255,255,255,0) 60%),
    radial-gradient(90% 60% at 80% 100%,
      rgba(255,255,255,.06) 0%,
      rgba(255,255,255,0) 70%);
}

/* Flicker + micro jitter (subtle) */
.crt{
  animation: flicker 5.0s infinite;
  will-change: transform, filter;
}
@keyframes flicker{
  0%,100% { filter: brightness(1) contrast(1.0); transform: translateY(0); }
  48% { filter: brightness(1.02) contrast(1.03); }
  50% { filter: brightness(.98) contrast(1.08); transform: translateY(.6px); }
  52% { filter: brightness(1.01) contrast(1.04); transform: translateY(-.4px); }
}

@keyframes noiseShift{
  0%{ transform: translate(0,0); }
  25%{ transform: translate(-2px,1px); }
  50%{ transform: translate(2px,-1px); }
  75%{ transform: translate(1px,2px); }
  100%{ transform: translate(0,0); }
}

/* ===== Little helpers ===== */
.small{ font-size: 14px; }
.dim{ color: var(--phosphor-dim); }
hr{
  border:none;
  border-top:1px solid rgba(124,255,122,.25);
  margin:14px 0;
}
.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}